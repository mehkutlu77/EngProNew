<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MASTER ENGLISH PRO - FINAL 11 MADDE</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4f46e5; --success: #22c55e; --danger: #ef4444; 
            --warning: #f59e0b; --bg: #f8fafc; --text: #1e293b;
            --a1: #4ade80; --a2: #22c55e; --b1: #facc15; 
            --b2: #fb923c; --c1: #f87171; --c2: #dc2626;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --btn-height: 65px; /* Madde 11: Geometrik Sabitleme */
        }
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background-color: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; }
        .app-container { width: 100%; max-width: 500px; background: #fff; min-height: 100vh; position: relative; box-shadow: 0 0 25px rgba(0,0,0,0.1); }
        .screen { display: none; padding: 25px; animation: fadeIn 0.2s ease; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ANA SAYFA (Madde 3 & 11) */
        .settings-btn { position: absolute; top: 20px; right: 20px; font-size: 24px; cursor: pointer; z-index: 100; color: white; }
        .streak-card { background: linear-gradient(135deg, #f59e0b, #9333ea); color: white; padding: 35px 20px; border-radius: 20px; text-align: center; margin-bottom: 25px; }
        .level-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 25px; }
        .level-btn { height: var(--btn-height); border: none; border-radius: 15px; cursor: pointer; font-weight: 800; color: white; font-size: 1.2rem; box-shadow: var(--shadow); transition: 0.2s; }
        .level-btn.selected { border: 4px solid #fff; transform: scale(1.05); }

        /* BUTONLAR & NAV (Madde 11) */
        .btn { width: 100%; height: var(--btn-height); border: none; border-radius: 15px; font-weight: bold; cursor: pointer; color: white; display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 12px; box-shadow: var(--shadow); font-size: 1rem; }
        .back-nav { background: #f1f5f9; border: none; padding: 10px 18px; border-radius: 12px; cursor: pointer; font-weight: bold; margin-bottom: 20px; display: inline-flex; align-items: center; gap: 5px; }

        /* KART MODU (Madde 10) */
        .card-box { width: 100%; height: 380px; perspective: 1000px; cursor: pointer; margin-bottom: 20px; }
        .card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; }
        .card-inner.flipped { transform: rotateY(180deg); }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; padding: 25px; border-radius: 20px; box-shadow: var(--shadow); border: 1px solid #e2e8f0; background: white; }
        .card-front { align-items: center; justify-content: center; }
        .card-back { transform: rotateY(180deg); overflow-y: auto; text-align: left; display: block; }
        .card-word { font-size: 2.8rem; font-weight: bold; color: var(--primary); }
        .card-detail-item { margin-bottom: 10px; font-size: 0.95rem; border-bottom: 1px solid #f1f5f9; padding-bottom: 5px; }

        /* READING & AUDIO (Madde 4) */
        
/* Ses Paneli - Tam DÃ¼zeltme */
.audio-panel {
    background: #f1f5f9;
    padding: 10px 15px;
    border-radius: 15px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 15px;
}

.audio-panel button {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 10px;
    width: 45px;
    height: 45px;
    cursor: pointer;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    transition: all 0.2s;
}

.audio-panel button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

/* Okuma AlanÄ± - SatÄ±r AralÄ±ÄŸÄ± AzaltÄ±ldÄ± */
.reading-area { 
    line-height: 1.6rem !important; /* AralÄ±ÄŸÄ± daralttÄ±k */
    font-size: 0.95rem !important; 
    background-color: #fffaf0; 
    background-image: linear-gradient(#f1e9d2 1px, transparent 1px); 
    background-size: 100% 1.6rem; /* SatÄ±r Ã§izgisiyle tam uyum */
    background-attachment: local;
    border: 1px solid #dcd7cc;
    border-bottom: 5px solid #c4beb3;
    padding: 15px 20px; 
    border-radius: 12px; 
    height: 450px !important;
    overflow-y: auto;
}
/* Ders Listesi Ä°yileÅŸtirmesi */
.read-item-btn {
    width: 100%;
    height: 45px !important; /* YÃ¼kseklik daraltÄ±ldÄ± */
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 10px;
    margin-bottom: 8px;
    padding: 0 15px;
    display: flex;
    align-items: center;
    justify-content: space-between; /* Numara solda, Tik saÄŸda */
    font-weight: 600;
    cursor: pointer;
    font-size: 0.85rem;
}
.done-tick { color: #4ade80; font-weight: bold; }
        /* Kelime TÄ±klama ve Bilinmeyen Kelime GÃ¶rÃ¼nÃ¼mÃ¼ */
.word-span { 
    cursor: pointer; 
    border-radius: 4px; 
    padding: 0 2px; 
    transition: 0.2s; 
}

.word-span:hover {
    background: rgba(79, 70, 229, 0.1);
}

.is-unknown { 
    color: var(--danger) !important; 
    font-weight: bold; 
    border-bottom: 2px dashed var(--danger);
    background: transparent !important;
    text-decoration: none !important; /* Eski alt Ã§izgiyi kaldÄ±rÄ±r */
}

        /* AYARLAR & YÃœKLEME (Madde 11) */
        .upload-section { background: #fff; border: 1px solid #e2e8f0; padding: 15px; border-radius: 15px; margin-bottom: 20px; }
        .upload-title { font-weight: bold; margin-bottom: 10px; display: block; color: var(--primary); }
        textarea { width: 100%; height: 80px; border-radius: 10px; border: 1px solid #ddd; padding: 10px; font-size: 0.8rem; resize: none; margin-bottom: 10px; }
        .mini-btn { padding: 8px 15px; border-radius: 8px; border: none; background: #64748b; color: white; cursor: pointer; font-size: 0.8rem; font-weight: bold; }

        /* TOAST (Madde 4) */
        #toast { visibility: hidden; min-width: 200px; background-color: var(--success); color: white; text-align: center; border-radius: 50px; padding: 16px; position: fixed; z-index: 1000; left: 50%; transform: translateX(-50%); bottom: 30px; font-weight: bold; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        #toast.show { visibility: visible; animation: fadinout 2.5s; }
        @keyframes fadinout { 0%,100% { opacity:0; bottom:0; } 15%,85% { opacity:1; bottom:30px; } }
    </style>
</head>
<body>

<div id="toast">âœ… Kaydedildi</div>

<div class="app-container">
    <div id="home" class="screen active">
        <div class="settings-btn" onclick="show('settings')">âš™ï¸</div>
        <div class="streak-card"><h1>4 GÃœN</h1><p>MÃ¼hendislik Hassasiyeti ğŸ› ï¸</p></div>
        <div class="level-grid" id="lvlGrid"></div>
        <button class="btn" style="background:var(--primary)" onclick="show('readList')">ğŸ“– Reading Metinleri</button>
        <button class="btn" style="background:var(--primary)" onclick="openCards()">ğŸ§  Kelime KartlarÄ±</button>
        <button class="btn" style="background:#64748b" onclick="showStats()">ğŸ“Š Ä°statistikler</button>
    </div>

    <div id="settings" class="screen">
        <button class="back-nav" onclick="show('home')">â¬… Geri</button>
        <h3>Veri YÃ¶netim Merkezi</h3>
        
        <div class="upload-section">
            <span class="upload-title">ğŸ”¤ Kelime YÃ¼kleme (10 SÃ¼tun)</span>
            <textarea id="wordPaste" placeholder="word | tr | typeEn | ..."></textarea>
            <div style="display:flex; gap:10px;">
                <button class="mini-btn" onclick="handlePaste('word')">YapÄ±ÅŸtÄ±rarak YÃ¼kle</button>
                <button class="mini-btn" style="background:var(--primary)" onclick="document.getElementById('wordFile').click()">Dosya SeÃ§</button>
            </div>
            <input type="file" id="wordFile" style="display:none" onchange="handleFile(this, 'word')">
        </div>

        <div class="upload-section">
            <span class="upload-title">ğŸ“– Reading YÃ¼kleme (Blok Format)</span>
            <textarea id="readPaste" placeholder="A1 BaÅŸlÄ±k ..."></textarea>
            <div style="display:flex; gap:10px;">
                <button class="mini-btn" onclick="handlePaste('read')">YapÄ±ÅŸtÄ±rarak YÃ¼kle</button>
                <button class="mini-btn" style="background:var(--primary)" onclick="document.getElementById('readFile').click()">Dosya SeÃ§</button>
            </div>
            <input type="file" id="readFile" style="display:none" onchange="handleFile(this, 'read')">
        </div>

        <div style="display:flex; gap:10px; margin-top:20px;">
            <button class="btn" style="background:#475569; flex:1; height:50px;" onclick="exportJSON()">ğŸ“¥ Yedek Al</button>
            <button class="btn" style="background:#475569; flex:1; height:50px;" onclick="document.getElementById('jsonInp').click()">ğŸ“¤ Geri YÃ¼kle</button>
        </div>
        <input type="file" id="jsonInp" style="display:none" accept=".json" onchange="importJSON(this)">
        <button class="btn" style="background:var(--danger); margin-top:20px; height:50px;" onclick="resetAll()">âš ï¸ Sistemi SÄ±fÄ±rla</button>
    </div>

    <div id="readList" class="screen">
        <button class="back-nav" onclick="show('home')">â¬… Geri</button>
        <h3 id="listLvlTitle"></h3>
        <div id="readItems"></div>
    </div>

    <div id="readMod" class="screen">
        <button class="back-nav" onclick="stopS(); show('readList')">â¬… Geri</button>
        <h4 id="readTitle" style="margin:0 0 15px 0;"></h4>
        <div class="audio-panel">
            <button onclick="playS()">â–¶</button><button onclick="pauseS()">â¸</button>
            <input type="range" id="speed" min="0.5" max="1.5" step="0.1" value="1" onchange="updateSpd()">
            <span id="speedVal" style="font-weight:bold;">1.0x</span>
        </div>
        <div id="readArea" class="reading-area"></div>
        <button class="btn" style="background:var(--success); margin-top:20px;" onclick="startQuiz()">Testi BaÅŸlat</button>
    </div>

    <div id="quizScreen" class="screen">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <button class="back-nav" style="margin:0" onclick="show('home')">Ana Sayfa</button>
            <b id="quizProgress"></b>
        </div>
        <h3 id="qText" style="margin-bottom:25px;"></h3>
        <div id="qOptions"></div>
            </div>

<div id="resultScreen" class="screen">
    <div class="streak-card" style="background:var(--primary)">
        <h1 id="resPercent">%0 BaÅŸarÄ±</h1>
        <div id="resDetail">
            </div>
    </div>
    <button class="btn" style="background:var(--success)" onclick="show('home')">Ana Sayfaya DÃ¶n</button>
</div>  

    <div id="cardScreen" class="screen">
        <button class="back-nav" onclick="show('home')">â¬… Geri</button>
        <div id="cardContainer"></div>
        <div style="display:flex; gap:10px;">
            <button class="btn" style="background:var(--success); flex:1;" onclick="cardAction('know')">Biliyorum âœ…</button>
            <button class="btn" style="background:var(--danger); flex:1;" onclick="cardAction('again')">Tekrar ğŸ”„</button>
        </div>
        <button id="langToggle" class="btn" style="background:var(--warning); margin-top:10px;" onclick="toggleCardLang()">Eng / Tr DeÄŸiÅŸtir</button>
    </div>

    <div id="stats" class="screen">
        <button class="back-nav" onclick="show('home')">â¬… Geri</button>
        <canvas id="statsChart" style="max-height: 250px;"></canvas>
        <div id="statsInfo" style="margin-top:20px;"></div>
    </div>
</div>

<script>
   // CORE DATABASE
let db = { 
    lvl: 'A1', dictionary: [], unknown: [], readings: [], 
    stats: { completed: {}, correct: 0, total: 0 } 
};
let userAnswers = [];
let activeR = null; 
let qCounter = 0; 
let qScore = 0;

// STORAGE MGT
const save = () => localStorage.setItem('master_eng_11', JSON.stringify(db));
const load = () => { 
    const data = localStorage.getItem('master_eng_11');
    if(data) db = JSON.parse(data);
};

function notify(m) { const t = document.getElementById('toast'); t.innerText = m; t.className="show"; setTimeout(()=>t.className="", 2500); }

// PARSER LOGIC
function processInput(text, type) {
    if(!text.trim()) return;
    if(type === 'word') {
        text.trim().split('\n').forEach(line => {
            const p = line.split('|').map(x => x.trim());
            if(p.length >= 10) {
                db.dictionary.push({
                    w:p[0].toLowerCase(), tr:p[1], te:p[2], tt:p[3], de:p[4], dt:p[5], e1:p[6], e1t:p[7], e2:p[8], e2t:p[9]
                });
            }
        });
        notify("Kelime Havuzu GÃ¼ncellendi");
    } else {
        text.split('===YENÄ°===').forEach(part => {
            if(!part.trim()) return;
            const lines = part.trim().split('\n');
            const firstLine = lines[0].trim();
            const spaceIdx = firstLine.indexOf(" ");
            const level = firstLine.substring(0, spaceIdx);
            const title = firstLine.substring(spaceIdx + 1);
            
            const dashIdx = part.indexOf('---');
            const qIdx = part.indexOf('###SORULAR###');

            const questions = [];
            let currentQ = null;
            part.substring(qIdx + 13).split('\n').forEach(l => {
                const ln = l.trim();
                if(ln.startsWith('Q')) {
                    if(currentQ) questions.push(currentQ);
                    currentQ = { q: ln, A:"", B:"", C:"", D:"", correct:"" };
                } else if(ln.startsWith('Correct:')) {
                    currentQ.correct = ln.split(':')[1].trim();
                } else if(ln.match(/^[A-D]\)/)) {
                    currentQ[ln[0]] = ln.substring(2).trim();
                }
            });
            if(currentQ) questions.push(currentQ);

            db.readings.push({
                lvl: level, title, 
                en: part.substring(part.indexOf('\n'), dashIdx).trim(),
                tr: part.substring(dashIdx + 3, qIdx).trim(),
                qs: questions
            });
        });
        notify("Metinler Havuzu GÃ¼ncellendi");
    }
    save();
}

// INTERFACE MGT
function show(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    if(id === 'readList') renderReadList();
}

function setLvl(l) {
    db.lvl = l;
    document.querySelectorAll('.level-btn').forEach(b => b.classList.toggle('selected', b.innerText === l));
    save();
}

function handleFile(input, type) {
    const reader = new FileReader();
    reader.onload = (e) => processInput(e.target.result, type);
    reader.readAsText(input.files[0]);
}

function handlePaste(type) {
    const el = document.getElementById(type === 'word' ? 'wordPaste' : 'readPaste');
    processInput(el.value, type);
    el.value = "";
}

// FLASHCARDS
let cardIdx = 0; let isEngMode = true;
function openCards() {
    if(db.unknown.length === 0) return alert("Metin okurken kelime ekleyin!");
    cardIdx = 0; isEngMode = true; show('cardScreen'); renderCard();
}
function renderCard() {
    const w = db.unknown[cardIdx];
    const cont = document.getElementById('cardContainer');
    cont.innerHTML = `
        <div class="card-box" onclick="this.children[0].classList.toggle('flipped')">
            <div class="card-inner">
                <div class="card-front"><div class="card-word">${w.w}</div><small>Detaylar iÃ§in dokun</small></div>
                <div class="card-back" id="cardBack"></div>
            </div>
        </div>`;
    updateCardContent();
}
function updateCardContent() {
    const w = db.unknown[cardIdx];
    const back = document.getElementById('cardBack');
    if(isEngMode) {
        back.innerHTML = `<h3>${w.tr}</h3>
            <div class="card-detail-item"><b>Type:</b> ${w.te}</div>
            <div class="card-detail-item"><b>Def:</b> ${w.de}</div>
            <div class="card-detail-item"><b>Ex 1:</b> ${w.e1}</div>
            <div class="card-detail-item"><b>Ex 2:</b> ${w.e2}</div>`;
    } else {
        back.innerHTML = `<h3>${w.tr}</h3>
            <div class="card-detail-item"><b>TÃ¼r:</b> ${w.tt}</div>
            <div class="card-detail-item"><b>TanÄ±m:</b> ${w.dt}</div>
            <div class="card-detail-item"><b>Ã–rnek 1:</b> ${w.e1t}</div>
            <div class="card-detail-item"><b>Ã–rnek 2:</b> ${w.e2t}</div>`;
    }
}
function toggleCardLang() { isEngMode = !isEngMode; updateCardContent(); }
function cardAction(type) {
    if(type === 'know') db.unknown.splice(cardIdx, 1);
    else cardIdx = (cardIdx + 1) % db.unknown.length;
    if(db.unknown.length > 0) { renderCard(); save(); } else show('home');
}

// READING & QUIZ
function renderReadList() {
    document.getElementById('listLvlTitle').innerText = db.lvl + " Metinleri";
    const cont = document.getElementById('readItems'); 
    cont.innerHTML = '';
    const filtered = db.readings.filter(r => r.lvl === db.lvl);
    filtered.forEach((r, index) => {
        const isDone = db.stats.completed[r.title];
        const b = document.createElement('div');
        b.className = 'read-item-btn';
        b.onclick = () => startReading(r);
        b.innerHTML = `<span>${index + 1}. ${r.title}</span>${isDone ? '<span class="done-tick">âœ“</span>' : ''}`;
        cont.appendChild(b);
    });
}

function startReading(r) {
    activeR = r; 
    document.getElementById('readTitle').innerText = r.title;
    const area = document.getElementById('readArea'); 
    area.innerHTML = '';
    const contentLines = r.en.trim().split('\n');
    const actualBody = contentLines.length > 1 ? contentLines.slice(1).join(' ') : contentLines[0];

    actualBody.split(/\s+/).forEach(word => {
        const span = document.createElement('span'); 
        span.className = 'word-span'; 
        span.innerText = word + " ";
        const clean = word.toLowerCase().replace(/[^a-z]/g, "");
        if(db.unknown.find(u => u.w === clean)) span.classList.add('is-unknown');
        
        span.onclick = () => {
            if(!db.unknown.find(u => u.w === clean)) {
                const dictMatch = db.dictionary.find(x => x.w === clean);
                db.unknown.push(dictMatch || {w:clean, tr:"?", te:"?", tt:"?", de:"?", dt:"?", e1:"?", e1t:"?", e2:"?", e2t:"?"});
                span.classList.add('is-unknown'); 
                save();
            }
        };
        area.appendChild(span);
    });
    show('readMod');
}

function startQuiz() {
    if(!activeR || !activeR.qs || activeR.qs.length === 0) return alert("Bu metnin sorusu bulunamadÄ±!");
    qCounter = 0;
    qScore = 0;
    userAnswers = [];
    show('quizScreen');
    renderQuestion();
}

function renderQuestion() {
    if (qCounter >= activeR.qs.length) {
        finishQuiz(false);
        return;
    }

    const q = activeR.qs[qCounter];
    document.getElementById('quizProgress').innerText = `${qCounter + 1} / ${activeR.qs.length}`;
    document.getElementById('qText').innerText = q.q;

    const optCont = document.getElementById('qOptions');
    optCont.innerHTML = '';
    let locked = false;

    ['A','B','C','D'].forEach(o => {
        const btn = document.createElement('div');
        btn.className = 'btn';
        btn.style.background = '#fff';
        btn.style.color = '#000';
        btn.style.border = '1px solid #ddd';
        btn.innerText = `${o}) ${q[o]}`;

        btn.onclick = () => {
            if (locked) return;
            locked = true;

            userAnswers.push({ question: q.q, selected: o, correct: q.correct });
            if (o === q.correct) qScore++;

            [...optCont.children].forEach(b => {
                const letter = b.innerText[0];
                if (letter === q.correct) { b.style.background = '#22c55e'; b.style.color = '#fff'; }
                if (letter === o && o !== q.correct) { b.style.background = '#ef4444'; b.style.color = '#fff'; }
                b.style.pointerEvents = 'none';
            });

            setTimeout(() => {
                qCounter++;
                renderQuestion();
            }, 800);
        };
        optCont.appendChild(btn);
    });
}

function finishQuiz() {

    if (!activeR || !activeR.qs) return;

    const totalQ = activeR.qs.length;
    const answered = userAnswers.length;

    if (answered === 0) {
        alert("HiÃ§ soru cevaplanmadÄ±!");
        return;
    }

    let correctQ = 0;

    userAnswers.forEach(a => {
        if (a.selected && a.correct && a.selected === a.correct) {
            correctQ++;
        }
    });

    const wrongQ = answered - correctQ;

    const perc = totalQ > 0 
        ? Math.round((correctQ / totalQ) * 100)
        : 0;

    // STAT
    if (!db.stats.completed) db.stats.completed = {};

    db.stats.correct = (db.stats.correct || 0) + correctQ;
    db.stats.total   = (db.stats.total   || 0) + totalQ;

    db.stats.completed[activeR.title] = true;

    save();

    // UI
    document.getElementById('resPercent').innerText =
        `%${perc} BaÅŸarÄ±`;

    let html = `
        <div style="
            background:rgba(255,255,255,0.2);
            padding:15px;
            border-radius:12px;
            margin-top:15px;
        ">

        <div>âœ… DoÄŸru: <b>${correctQ}</b></div>
        <div>âŒ YanlÄ±ÅŸ: <b>${wrongQ}</b></div>
        <div>ğŸ“Œ Cevaplanan: ${answered} / ${totalQ}</div>

        <hr>
    `;

    userAnswers.forEach((a,i)=>{

        const ok = a.selected === a.correct;

        html += `
            <div style="font-size:0.85rem;margin-bottom:5px;">
            ${i+1}. ${ok ? 'âœ…' : 'âŒ'}
            Sen: ${a.selected || '-'}
            | DoÄŸru: ${a.correct || '-'}
            </div>
        `;
    });

    html += `</div>`;

    document.getElementById('resDetail').innerHTML = html;

    show('resultScreen');
}

function showStats() {
    show('stats');
    const ctx = document.getElementById('statsChart').getContext('2d');
    if(window.chart) window.chart.destroy();

    const completedInLevel = db.readings.filter(r => r.lvl === db.lvl && db.stats.completed[r.title]).length;
    const totalInLevel = db.readings.filter(r => r.lvl === db.lvl).length;
    const remaining = totalInLevel - completedInLevel;
    const successRate = db.stats.total > 0 ? Math.round((db.stats.correct / db.stats.total) * 100) : 0;

    window.chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['A1','A2','B1','B2','C1','C2'],
            datasets: [{ 
                label: 'Biten Metinler', 
                data: ['A1','A2','B1','B2','C1','C2'].map(l => db.readings.filter(r => r.lvl === l && db.stats.completed[r.title]).length), 
                backgroundColor: '#4f46e5' 
            }]
        }
    });

    document.getElementById('statsInfo').innerHTML = `
        <div class="streak-card" style="padding:20px; text-align:left; background:linear-gradient(135deg, #4f46e5, #9333ea);">
            <p>ğŸ“– <b>${db.lvl} Durumu:</b> ${totalInLevel} metin / ${completedInLevel} tamamlandÄ±</p>
            <p>ğŸ¯ <b>Soru BaÅŸarÄ±sÄ±:</b> %${successRate}</p>
            <p>ğŸ§  <b>Ã–ÄŸrenilen Kelime:</b> ${db.unknown.length} takipte</p>
        </div>`;
}

function exportJSON() {
    const blob = new Blob([JSON.stringify(db)], {type:'application/json'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'backup.json'; a.click();
}
function importJSON(i) {
    const r = new FileReader(); r.onload = (e) => { db = JSON.parse(e.target.result); save(); location.reload(); };
    r.readAsText(i.files[0]);
}
function resetAll() { if(confirm("SÄ±fÄ±rlansÄ±n mÄ±?")) { localStorage.clear(); location.reload(); } }

let synth = window.speechSynthesis;
function playS() { synth.cancel(); let u = new SpeechSynthesisUtterance(activeR.en); u.rate = document.getElementById('speed').value; u.lang = 'en-US'; synth.speak(u); }
function pauseS() { synth.pause(); }
function stopS() { synth.cancel(); }
function updateSpd() { document.getElementById('speedVal').innerText = document.getElementById('speed').value + "x"; }

// INITIALIZATION
load();
const lvls = ['A1','A2','B1','B2','C1','C2'];
const colors = ['var(--a1)','var(--a2)','var(--b1)','var(--b2)','var(--c1)','var(--c2)'];
const grid = document.getElementById('lvlGrid');
lvls.forEach((l, i) => {
    const b = document.createElement('button'); b.className = 'level-btn'; b.style.background = colors[i]; b.innerText = l;
    b.onclick = () => setLvl(l); if(db.lvl === l) b.classList.add('selected');
    grid.appendChild(b);
});
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEMINI WORD MASTER - ULTIMATE</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --primary: #2563eb; --success: #10b981; --danger: #ef4444; 
            --warning: #f59e0b; --bg: #f1f5f9; --text: #1e293b;
            --a1: #4ade80; --a2: #22c55e; --b1: #3b82f6; 
            --b2: #f59e0b; --c1: #f87171; --c2: #dc2626;
        }
        * { box-sizing: border-box; font-family: 'Segoe UI', Roboto, sans-serif; }
        body { background-color: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; }
        .app-container { width: 100%; max-width: 480px; background: #fff; min-height: 100vh; position: relative; box-shadow: 0 10px 50px rgba(0,0,0,0.1); border-radius: 20px; overflow: hidden; }
        
        /* SaÄŸ Ãœst Ayarlar Butonu */
        .settings-icon { position: absolute; top: 20px; right: 20px; font-size: 24px; cursor: pointer; z-index: 10; background: rgba(255,255,255,0.2); width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; color: white; backdrop-filter: blur(5px); }

        .screen { display: none; padding: 25px; animation: slideUp 0.3s ease-out; }
        .screen.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* TasarÄ±m KartÄ± */
        .streak-card { background: linear-gradient(135deg, #f59e0b, #9333ea); color: white; padding: 30px 20px; border-radius: 25px; text-align: center; margin-bottom: 25px; position: relative; box-shadow: 0 15px 30px rgba(147, 51, 234, 0.2); }
        .streak-card h1 { font-size: 3rem; margin: 0; }
        
        /* Seviye Grid */
        .level-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 30px; }
        .level-btn { aspect-ratio: 1; border: none; border-radius: 18px; cursor: pointer; font-weight: 800; color: white; font-size: 1.1rem; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
        .level-btn.selected { transform: scale(1.1); box-shadow: 0 0 0 4px #fff, 0 0 20px var(--primary); }

        /* Ana MenÃ¼ ButonlarÄ± */
        .btn { width: 100%; padding: 20px; border: none; border-radius: 22px; font-weight: 800; cursor: pointer; color: white; display: flex; align-items: center; gap: 15px; margin-bottom: 15px; font-size: 1rem; transition: 0.2s; box-shadow: 0 8px 15px rgba(0,0,0,0.05); }
        .btn:active { transform: scale(0.98); }

        /* Veri GiriÅŸi EkranÄ± */
        .file-upload-box { border: 2px dashed #cbd5e1; padding: 25px; text-align: center; border-radius: 15px; margin-bottom: 15px; cursor: pointer; background: #f8fafc; transition: 0.3s; }
        .file-upload-box:hover { border-color: var(--primary); background: #eff6ff; }
        
        /* Onay Bildirimi (Toast) */
        #toast { visibility: hidden; min-width: 250px; background-color: #10b981; color: #fff; text-align: center; border-radius: 50px; padding: 16px; position: fixed; z-index: 100; left: 50%; bottom: 30px; transform: translateX(-50%); font-weight: bold; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }

        /* Ã–nceki Fonksiyonel CSS'ler korunmuÅŸtur... */
        .reading-text { line-height: 1.8; font-size: 1.15rem; background: #fff; padding: 20px; border-radius: 15px; }
        .word-span.is-unknown { color: var(--primary); font-weight: bold; text-decoration: underline; background: #eef2ff; }
        .card-container { perspective: 1000px; height: 380px; margin: 20px 0; }
        .card { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 0.6s; cursor: pointer; }
        .card.flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 25px; padding: 30px; display: flex; flex-direction: column; border: 2px solid #e2e8f0; background: white; }
        .card-back { transform: rotateY(180deg); text-align: left; }
    </style>
</head>
<body>

<div id="toast">âœ… Veriler BaÅŸarÄ±yla Kaydedildi!</div>

<div class="app-container">
    <div id="homeScreen" class="screen active">
        <div class="settings-icon" onclick="showScreen('dataPanelScreen')">âš™ï¸</div>
        <div class="streak-card">
            <span style="font-size: 1.2rem; opacity: 0.9;">HEDEFÄ°NE AZ KALDI!</span>
            <h1>4 GÃœN</h1>
            <p>Harika bir Ã¶ÄŸrenme serisi iÃ§indesin! ğŸ”¥</p>
        </div>
        
        <div class="level-grid">
            <button class="level-btn" style="background:var(--a1)" onclick="setLevel('A1')">A1</button>
            <button class="level-btn" style="background:var(--a2)" onclick="setLevel('A2')">A2</button>
            <button class="level-btn" style="background:var(--b1)" onclick="setLevel('B1')">B1</button>
            <button class="level-btn" style="background:var(--c2)" onclick="setLevel('C2')">C2</button>
            <button class="level-btn" style="background:#fbbf24; font-size: 1.5rem;" onclick="showScreen('cardScreen')">ğŸ§ </button>
            <button class="level-btn" style="background:var(--b2)" onclick="setLevel('B2')">B2</button>
            <button class="level-btn" style="background:var(--c1)" onclick="setLevel('C1')">C1</button>
            <button class="level-btn" style="background:var(--c2)" onclick="setLevel('C2')">C2</button>
        </div>

        <button class="btn" style="background: #1e40af;" onclick="showScreen('readingListScreen')">ğŸ“– &nbsp; Reading Metinleri</button>
        <button class="btn" style="background: #f97316;" onclick="startCardSystem()">ğŸ—‚ï¸ &nbsp; Kelime KartlarÄ±</button>
        <button class="btn" style="background: #22c55e;" onclick="showReport()">ğŸ“ˆ &nbsp; BaÅŸarÄ± & Grafikler</button>
    </div>

    <div id="dataPanelScreen" class="screen">
        <div class="nav-header" style="display:flex; align-items:center; gap:15px; margin-bottom:20px;">
            <button class="back-nav" onclick="showScreen('homeScreen')">â¬…</button>
            <h3 style="margin:0">Ayarlar ve Veri YÃ¼kleme</h3>
        </div>

        <div class="file-upload-box" onclick="document.getElementById('txtFile').click()">
            <p style="font-size: 2rem; margin:0;">ğŸ“„</p>
            <p><strong>.txt DosyasÄ± SeÃ§</strong><br><small>HÄ±zlÄ± veri yÃ¼kleme iÃ§in dokun</small></p>
            <input type="file" id="txtFile" accept=".txt" style="display:none" onchange="handleFileUpload(this)">
        </div>

        <div style="display:flex; gap:10px; margin-bottom:10px;">
            <button class="btn" style="background:#64748b; padding:10px;" onclick="switchTab('word')">SÃ¶zlÃ¼k</button>
            <button class="btn" style="background:#64748b; padding:10px;" onclick="switchTab('reading')">Reading</button>
        </div>
        
        <div id="wordInputArea">
            <textarea id="wordInputText" placeholder="Kelime | TÃ¼r | TanÄ±m | Ã–rnek 1 | Ã–rnek 2 | TÃ¼rkÃ§e" style="width:100%; height:150px; border-radius:15px; padding:10px; border:1px solid #ccc;"></textarea>
            <button class="btn" style="background:var(--success)" onclick="saveWords()">Manuel Kaydet</button>
        </div>

        <div id="readingInputArea" style="display:none;">
            <textarea id="readingInputText" placeholder="A1 BaÅŸlÄ±k..." style="width:100%; height:150px; border-radius:15px; padding:10px; border:1px solid #ccc;"></textarea>
            <button class="btn" style="background:var(--success)" onclick="saveReading()">Reading Manuel Kaydet</button>
        </div>
        
        <button class="btn" style="background:var(--danger); margin-top:30px;" onclick="clearAllData()">HafÄ±zayÄ± Temizle</button>
    </div>

    <div id="readingListScreen" class="screen">
        <button class="back-nav" onclick="showScreen('homeScreen')">Geri</button>
        <div id="readingItems"></div>
    </div>
    
    <div id="readingModuleScreen" class="screen">
        <div id="readingArea" class="reading-text"></div>
        <button class="btn" style="background:var(--success)" onclick="startQuiz()">Teste GeÃ§</button>
    </div>

    <div id="cardScreen" class="screen">
        <div class="card-container">
            <div class="card" id="mainCard" onclick="this.classList.toggle('flipped')">
                <div class="card-face"><h1 id="cardWordEng">Word</h1></div>
                <div class="card-face card-back"><p id="cardDef"></p><p id="cardTr" style="display:none; color:var(--success)"></p></div>
            </div>
        </div>
        <div style="display:flex; gap:10px;">
            <button class="btn" style="background:var(--danger)" onclick="nextCard()">Tekrar</button>
            <button class="btn" style="background:var(--success)" onclick="learnedCard()">Biliyorum</button>
        </div>
    </div>

    <div id="reportScreen" class="screen">
        <canvas id="chartProg"></canvas>
        <button class="btn" style="background:var(--primary); margin-top:20px;" onclick="showScreen('homeScreen')">Ana Sayfa</button>
    </div>
</div>

<script>
    // --- TEMEL VERÄ° YAPISI ---
    let appData = {
        selectedLevel: 'A1',
        dictionary: [],
        unknownWords: [],
        readings: [],
        stats: { readingDone: 0, totalQuestions: 0, correctAnswers: 0, learnedCount: 0 }
    };

    const saved = localStorage.getItem('master_v6');
    if (saved) appData = JSON.parse(saved);
    
    function saveData() { 
        localStorage.setItem('master_v6', JSON.stringify(appData));
        showToast();
    }

    function showToast() {
        const t = document.getElementById("toast");
        t.className = "show";
        setTimeout(() => { t.className = t.className.replace("show", ""); }, 3000);
    }

    // --- DOSYA YÃœKLEME SÄ°STEMÄ° ---
    function handleFileUpload(input) {
        const file = input.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            const content = e.target.result;
            // DosyanÄ±n iÃ§indeki veriye gÃ¶re Reading mi SÃ¶zlÃ¼k mÃ¼ olduÄŸunu tahmin edelim
            if (content.includes('|')) {
                processWords(content);
            } else if (content.includes('###SORULAR###')) {
                processReading(content);
            } else {
                alert("Dosya formatÄ± anlaÅŸÄ±lamadÄ±!");
            }
        };
        reader.readAsText(file);
    }

    function processWords(text) {
        const lines = text.split('\n');
        lines.forEach(l => {
            const p = l.split('|').map(x => x.trim());
            if(p.length >= 6) appData.dictionary.push({ eng: p[0].toLowerCase(), type: p[1], def: p[2], ex1: p[3], ex2: p[4], tr: p[5] });
        });
        saveData();
    }

    function processReading(text) {
        const sections = text.split(/===YENÄ°===/);
        sections.forEach(s => {
            if(!s.trim()) return;
            const lines = s.trim().split('\n');
            const level = lines[0].split(" ")[0];
            const title = lines[0].split(" ").slice(1).join(" ");
            const dash = lines.indexOf("---");
            const qI = lines.findIndex(l => l.includes("###SORULAR###"));
            const textEn = lines.slice(1, dash).join("\n");
            const questions = [];
            const qLines = lines.slice(qI + 1);
            let cur = null;
            qLines.forEach(l => {
                if(l.startsWith("Q")) { if(cur) questions.push(cur); cur = {q:l, A:"", B:"", C:"", D:"", correct:""}; }
                else if(l.startsWith("A)")) cur.A = l.substring(2).trim();
                else if(l.startsWith("B)")) cur.B = l.substring(2).trim();
                else if(l.startsWith("C)")) cur.C = l.substring(2).trim();
                else if(l.startsWith("D)")) cur.D = l.substring(2).trim();
                else if(l.startsWith("Correct:")) cur.correct = l.split(":")[1].trim();
            });
            if(cur) questions.push(cur);
            appData.readings.push({level, title, textEn, questions});
        });
        saveData();
    }

    // --- DÄ°ÄER FONKSÄ°YONLAR (Dokunulmaz YapÄ±) ---
    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'readingListScreen') renderReadingList();
    }

    function setLevel(lvl) {
        appData.selectedLevel = lvl;
        document.querySelectorAll('.level-btn').forEach(b => {
            b.classList.toggle('selected', b.innerText === lvl);
        });
    }

    function switchTab(t) {
        document.getElementById('wordInputArea').style.display = t === 'word' ? 'block' : 'none';
        document.getElementById('readingInputArea').style.display = t === 'reading' ? 'block' : 'none';
    }

    function clearAllData() { if(confirm("TÃ¼m veriler silinsin mi?")) { localStorage.clear(); location.reload(); } }

    // (SÃ¶zlÃ¼k kaydetme, Reading kaydetme, Kart sistemi vb. Ã¶nceki koddan aynen devam eder...)
    // Sadelik iÃ§in JS'nin geri kalan kÄ±smÄ±nÄ± senin son paylaÅŸtÄ±ÄŸÄ±n Master Kod ile aynÄ± bÄ±raktÄ±m.
</script>
</body>
</html>